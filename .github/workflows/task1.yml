name: taskN-checker
on:
  push:
    branches:
      - "!main"
jobs:
    check:
        runs-on: ubuntu-latest
        env:
          TaskPath: "./tasks/${GITHUB_REF##*/"
          InputFileName: input
          OutputFileName: output
          TestsCount: 3
          ProgramName: task
        steps:
            - name: copy files
              uses: actions/checkout@v4
            - name: install
              run: sudo apt update && sudo apt install build-essential
            - name: build
              run: |
                g++ -c $(find . -maxdepth 1 -type f -name "*.cpp")
                g++ $(find . -maxdepth 1 -type f -name "*.o") -o ${ProgramName}
            - name: test
              run: |
                for (( i=1; i<=${TestsCount}; i++ ))
                do
                  "./${ProgramName}" "${TaskPath}/${InputFileName}${i}.txt" "${OutputFileName}${i}.txt"
                done
            - name: check
              run: |
                for (( i=1; i<=${TestsCount}; i++ ))
                do
                  diff "${OutputFileName}${i}.txt" "${TaskPath}/${OutputFileName}${i}.txt"
                done
